module Trout.Game.MoveGen.Sliding.Magics
    ( bishopMagics
    , rookMagics
    , bishopBits
    , rookBits
    , genKey
    ) where

import           Data.Vector.Primitive (Vector)
import qualified Data.Vector.Primitive as V
import           Data.Word             (Word64)
import           Trout.Bitboard        (Bitboard, (!>>.))

bishopMagics :: Vector Word64
bishopMagics = V.fromList
    [ 0x0021080100540041
    , 0x2004080085020080
    , 0x010401240B100080
    , 0x04040C0080000000
    , 0x0014042101004100
    , 0x0040861040811120
    , 0x012D0401A0089002
    , 0x4220240402211040
    , 0x8448060410042100
    , 0x0200088148020040
    , 0x0901100122012104
    , 0x400802408B000900
    , 0x9800D20210110300
    , 0x800401040A400280
    , 0x0014020210048401
    , 0x2050004402280241
    , 0x0098002208300082
    , 0x0204060208286100
    , 0x5010000D00408100
    , 0x0204042201220000
    , 0x0004044082A00080
    , 0x1940800048200800
    , 0x0000511404240428
    , 0x2001251104010414
    , 0x0008053020041008
    , 0x0A10102008120482
    , 0x1000500001040080
    , 0x220A240008010820
    , 0x0004082044016005
    , 0x4008028006300400
    , 0x2088610006440200
    , 0x0218808800620800
    , 0x14900A7000A10491
    , 0x0008210880041840
    , 0x0C0040B000880440
    , 0x0000B20080080082
    , 0x0120020400308082
    , 0x311C101080044800
    , 0x2A10220209064900
    , 0x004E241820910081
    , 0x0210881840000820
    , 0x000042301028A460
    , 0xA800804340480801
    , 0x82A2042011008802
    , 0x0009401A92040900
    , 0x2120209006811140
    , 0x101009250C014302
    , 0x5022020042005104
    , 0x1001008804400400
    , 0x11890901D0040500
    , 0x1000010411140181
    , 0x8094800194040518
    , 0x00632008302400A0
    , 0x2008C82028008008
    , 0x411260081B014003
    , 0x081001020C004802
    , 0x0C81004120A01000
    , 0x848800C118280200
    , 0x0900120090480822
    , 0x0002800400A08800
    , 0x4806202410202210
    , 0x0E20002008302128
    , 0x0042200801012400
    , 0x220A440820810202
    ]

rookMagics :: Vector Word64
rookMagics = V.fromList
    [ 0x1880002210814000
    , 0x0040100020004008
    , 0x0180100081486001
    , 0x10800C0800500080
    , 0x0100080100043210
    , 0x0600100806000403
    , 0x0480010032002080
    , 0x48800080044A2300
    , 0x4000800021894002
    , 0x1020808020004000
    , 0x000A002050820141
    , 0x0001001820300100
    , 0x0902000892001460
    , 0x04120044AA005008
    , 0x10AC000108300624
    , 0x0000800080004100
    , 0x0200218000400088
    , 0x0000404010002000
    , 0x1082020060408030
    , 0x2080808008001001
    , 0x1108808008012400
    , 0x000080800C000A00
    , 0x6800C40018500102
    , 0x0000020000408411
    , 0x0000400080208000
    , 0x2140008080422000
    , 0x0003004100192000
    , 0x0850001080080080
    , 0x2280080180040080
    , 0x4145020080800400
    , 0x0801001100040200
    , 0x0022124200008104
    , 0x0010804002800824
    , 0x01B0006010400042
    , 0x0000128206002140
    , 0x2040805800801004
    , 0x0000100D01000800
    , 0x0C08100408014020
    , 0x0100021024000821
    , 0x8400800040800100
    , 0x00808424C0028004
    , 0x0050025220004000
    , 0x8460002010008080
    , 0x4140080010008080
    , 0x0801E40008008080
    , 0x0012008004008100
    , 0x1400100308040082
    , 0x00001284C4020009
    , 0x0010860140A10200
    , 0x240200A281004200
    , 0x058090A001044100
    , 0x3291001000200900
    , 0x0000080004008180
    , 0x0040040002008080
    , 0x86020009A4080200
    , 0x048000814C2B0200
    , 0x310B82401100220A
    , 0x4428810340051021
    , 0x0000411080282202
    , 0x003E001024084122
    , 0x800A00509820140A
    , 0x0042001401881016
    , 0x0000084110020084
    , 0x0421000242009061
    ]

bishopBits :: Vector Int
bishopBits = V.fromList
    [ 6, 5, 5, 5, 5, 5, 5, 6
    , 5, 5, 5, 5, 5, 5, 5, 5
    , 5, 5, 7, 7, 7, 7, 5, 5
    , 5, 5, 7, 9, 9, 7, 5, 5
    , 5, 5, 7, 9, 9, 7, 5, 5
    , 5, 5, 7, 7, 7, 7, 5, 5
    , 5, 5, 5, 5, 5, 5, 5, 5
    , 6, 5, 5, 5, 5, 5, 5, 6
    ]

rookBits :: Vector Int
rookBits = V.fromList
    [ 12,11,11,11,11,11,11,12
    , 11,10,10,10,10,10,10,11
    , 11,10,10,10,10,10,10,11
    , 11,10,10,10,10,10,10,11
    , 11,10,10,10,10,10,10,11
    , 11,10,10,10,10,10,10,11
    , 11,10,10,10,10,10,10,11
    , 12,11,11,11,11,11,11,12
    ]

genKey :: Bitboard -> Word64 -> Int -> Int
genKey masked magic bits = fromIntegral $ (masked * magic) !>>. (64 - bits)
